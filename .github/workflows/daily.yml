name: Daily Tick
on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:
    inputs:
      world:
        description: "World to tick when manually triggered"
        required: false
        default: staging

jobs:
  tick:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Select world
        id: select-world
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            world="${{ github.event.inputs.world }}"
            if [ -z "$world" ]; then
              world=staging
            fi
          else
            world=prod
          fi
          echo "value=$world" >> "$GITHUB_OUTPUT"
      - uses: actions/checkout@v3
      - name: Run simulation
        run: python sim.py ${{ steps.select-world.outputs.value }} --snapshot --log --update-readme
      - name: Commit world state
        run: python commit_world.py ${{ steps.select-world.outputs.value }}
      - name: Push changes
        run: git push
